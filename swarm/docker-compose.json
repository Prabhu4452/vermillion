{
    "networks": {
        "iudx-net": {
            "driver": "overlay"
        }
    },
    "services": {
        "dbconnector": {
            "cap_add": [
                "ALL"
            ],
            "container_name": "dbconnector",
            "deploy": {
                "labels": {
                    "type": "dbconnector"
                },
                "placement": {
                    "constraints": [
                        "node.role == worker"
                    ]
                }
            },
            "env_file": [
                ".env"
            ],
            "hostname": "dbconnector",
            "image": "iudx/dbconnector",
            "networks": [
                "iudx-net"
            ],
            "restart": "always",
            "volumes": [
                "../iudx-dbconnector:/iudx-dbconnector/"
            ]
        },
        "elk": {
            "cap_add": [
                "ALL"
            ],
            "container_name": "elk",
            "deploy": {
                "labels": {
                    "type": "database"
                },
                "placement": {
                    "constraints": [
                        "node.role == worker"
                    ]
                }
            },
            "env_file": [
                ".env"
            ],
            "hostname": "elk",
            "image": "nshou/elasticsearch-kibana",
            "networks": [
                "iudx-net"
            ],
            "ports": [
                "9200:9200",
                "5601:5601"
            ],
            "restart": "always",
            "volumes": [
                "elk-data:/home/ideam/elasticsearch-6.2.4"
            ]
        },
        "postgres": {
            "cap_add": [
                "ALL"
            ],
            "container_name": "postgres",
            "deploy": {
                "labels": {
                    "type": "auth-db"
                },
                "placement": {
                    "constraints": [
                        "node.role == worker"
                    ]
                }
            },
            "env_file": [
                ".env"
            ],
            "hostname": "postgres",
            "image": "iudx/postgres",
            "networks": [
                "iudx-net"
            ],
            "restart": "always",
            "volumes": [
                "pgsql-data:/var/lib/postgresql"
            ]
        },
        "rabbit1": {
            "cap_add": [
                "ALL"
            ],
            "deploy": {
                "labels": {
                    "type": "broker"
                },
                "placement": {
                    "constraints": [
                        "node.role == worker"
                    ]
                }
            },
            "env_file": [
                ".env"
            ],
            "hostname": "rabbit1",
            "image": "iudx/rabbitmq",
            "networks": [
                "iudx-net"
            ],
            "ports": [
                "15673:15672"
            ],
            "restart": "always",
            "volumes": [
                "broker-data:/var/lib/rabbitmq/",
                "./authenticator:/authenticator/",
                "./conf/rabbitmq:/etc/rabbitmq/"
            ]
        },
        "rabbit2": {
            "cap_add": [
                "ALL"
            ],
            "deploy": {
                "labels": {
                    "type": "broker"
                },
                "placement": {
                    "constraints": [
                        "node.role == worker"
                    ]
                }
            },
            "env_file": [
                ".env"
            ],
            "hostname": "rabbit2",
            "image": "iudx/rabbitmq",
            "networks": [
                "iudx-net"
            ],
            "ports": [
                "15674:15672"
            ],
            "restart": "always",
            "volumes": [
                "broker-data:/var/lib/rabbitmq/",
                "./authenticator:/authenticator/",
                "./conf/rabbitmq:/etc/rabbitmq/"
            ]
        },
        "unbind-daemon": {
            "cap_add": [
                "ALL"
            ],
            "container_name": "daemon",
            "deploy": {
                "labels": {
                    "type": "unbind-daemon"
                },
                "placement": {
                    "constraints": [
                        "node.role == manager"
                    ]
                }
            },
            "env_file": [
                ".env"
            ],
            "hostname": "daemon",
            "image": "iudx/unbind-daemon",
            "networks": [
                "iudx-net"
            ],
            "restart": "always"
        },
        "vertx": {
            "cap_add": [
                "ALL"
            ],
            "container_name": "vertx",
            "deploy": {
                "labels": {
                    "type": "http-proxy"
                },
                "placement": {
                    "constraints": [
                        "node.role == manager"
                    ]
                },
                "replicas": 1
            },
            "env_file": [
                ".env"
            ],
            "hostname": "vertx",
            "image": "iudx/vertx",
            "networks": [
                "iudx-net"
            ],
            "ports": [
                "443:8443"
            ],
            "restart": "always",
            "volumes": [
                "../iudx-api-server:/iudx-api-server/"
            ]
        }
    },
    "version": "3",
    "volumes": {
        "broker-data": null,
        "elk-data": null,
        "pgsql-data": null
    }
}
